import streamlit as st
import math
import datetime
import pandas as pd

# í˜ì´ì§€ ê¸°ë³¸ ì„¤ì •
st.set_page_config(page_title="íš¨ìœ¨ì ì¸ ê³µë¶€ì¤‘..", page_icon="âœï¸", layout="centered")

# ì œëª©
st.title("âœï¸ íš¨ìœ¨ì ì¸ ê³µë¶€ì¤‘..")
st.subheader("ë‚˜ì˜ ì„±í–¥ê³¼ ëª©í‘œë¥¼ ê¸°ë°˜ìœ¼ë¡œ íš¨ìœ¨ì ì¸ í•™ìŠµ í”Œëœì„ ì„¸ì›Œë“œë ¤ìš”!")

# ----------------------------
# 1ë‹¨ê³„: í•™ìŠµ ì„±í–¥ ì§„ë‹¨
# ----------------------------
st.markdown("## âœ¨ Step 1. í•™ìŠµ ì„±í–¥ ì§„ë‹¨")

fun_choice = st.radio(
    "ğŸ« ì´ˆì½œë¦¿ì´ ì¢‹ìœ¼ì„¸ìš”, â˜• ì»¤í”¼ê°€ ì¢‹ìœ¼ì„¸ìš”?",
    ["ğŸ« ì´ˆì½œë¦¿", "â˜• ì»¤í”¼", "ğŸ“š ë‘˜ ë‹¤!"]
)

if fun_choice == "ğŸ« ì´ˆì½œë¦¿":
    style = "ğŸ–¼ï¸ ì‹œê°í˜• (ë„í‘œ, ì´ë¯¸ì§€ ì¤‘ì‹¬)"
elif fun_choice == "â˜• ì»¤í”¼":
    style = "ğŸ§ ì²­ê°í˜• (ê°•ì˜, ì„¤ëª… ì¤‘ì‹¬)"
else:
    style = "âœï¸ ì‹¤ì²œí˜• (ë¬¸ì œí’€ì´, ì‹¤ìŠµ ìœ„ì£¼)"

focus_time = st.radio(
    "ğŸ• ì§‘ì¤‘ì´ ì˜ ë˜ëŠ” ì‹œê°„ëŒ€ëŠ”?",
    ["ğŸŒ… ì•„ì¹¨", "ğŸŒ ì˜¤í›„", "ğŸŒ™ ë°¤"]
)

study_mode = st.radio(
    "ğŸ“– ì„ í˜¸í•˜ëŠ” í•™ìŠµ ë°©ì‹ì€?",
    ["â±ï¸ ì§§ê²Œ ìì£¼ ë°˜ë³µ", "ğŸ’¡ ì˜¤ë˜ ëª°ì…í•´ì„œ ì§‘ì¤‘"]
)

st.markdown("---")

# ----------------------------
# 2ë‹¨ê³„: í•™ìŠµ ëª©í‘œ ë° ì‹œê°„
# ----------------------------
st.markdown("## âœ¨ Step 2. í•™ìŠµ ëª©í‘œì™€ ì‹œê°„ ì…ë ¥")

goals_input = st.text_area(
    "ğŸ“Œ í•™ìŠµ ëª©í‘œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì—¬ëŸ¬ ê°œ ì…ë ¥ ì‹œ ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)",
    placeholder="ì˜ˆ) ìˆ˜í•™ 5ë‹¨ì› ì™„ë²½ ì´í•´\nì˜ì–´ ë‹¨ì–´ 300ê°œ ì•”ê¸°\ní•œêµ­ì‚¬ ì—°í‘œ ì •ë¦¬",
    height=100
)
goals = [g.strip() for g in goals_input.split("\n") if g.strip()]

days_left = st.number_input("â³ ë‚¨ì€ ì¼ìˆ˜ (ë©°ì¹  ì•ˆì— ì™„ë£Œí•´ì•¼ í•˜ë‚˜ìš”?)", min_value=1, value=7)
hours_per_day = st.slider("ğŸ• í•˜ë£¨ì— í•™ìŠµ ê°€ëŠ¥í•œ ì‹œê°„ (ì‹œê°„)", min_value=1, max_value=12, value=4)

# ----------------------------
# 3ë‹¨ê³„: í•™ìŠµ ê³„íš ìƒì„±
# ----------------------------
if st.button("ğŸ“– ë‚˜ë§Œì˜ í•™ìŠµ ê³„íš ì„¸ìš°ê¸°"):
    total_hours = days_left * hours_per_day
    study_blocks = int(total_hours / 1.5)   # 1.5ì‹œê°„ ë‹¨ìœ„ ë¸”ë¡
    daily_blocks = math.ceil(study_blocks / days_left)

    # ğŸ”¹ ëª©í‘œ ë¶„ë°° (ê· ë“± ë°°ë¶„)
    plan = []
    today = datetime.date.today()
    for i in range(days_left):
        date = today + datetime.timedelta(days=i)
        # ëª©í‘œ ìˆœí™˜ ë°°ì •
        assigned_goal = goals[i % len(goals)] if goals else "ëª©í‘œ ì—†ìŒ"
        plan.append({"ë‚ ì§œ": date, "ì¶”ì²œ ëª©í‘œ": assigned_goal, "ë¸”ë¡ ìˆ˜": daily_blocks})

    df_plan = pd.DataFrame(plan)

    # ----------------------------
    # ê²°ê³¼ ì¶œë ¥
    # ----------------------------
    st.markdown("## âœ… ë§ì¶¤ í•™ìŠµ í”Œëœ")

    st.write(f"ì´ í•™ìŠµ ê°€ëŠ¥ ì‹œê°„: **{total_hours}ì‹œê°„**")
    st.write(f"í•˜ë£¨ ê¶Œì¥ í•™ìŠµ ë¸”ë¡: **{daily_blocks} ë¸”ë¡** (ì•½ {daily_blocks*1.5:.1f}ì‹œê°„)")

    st.markdown("### ğŸ“… í•™ìŠµ ìº˜ë¦°ë”")
    st.dataframe(df_plan, use_container_width=True)

    # ----------------------------
    # ìš°ì„ ìˆœìœ„ ì¶”ì²œ
    # ----------------------------
    st.markdown("### ğŸ“Œ ì¶”ì²œ í•™ìŠµ ìˆœì„œ")
    st.info(
        "1ï¸âƒ£ ì•”ê¸° ê³¼ëª© (ì˜ˆ: ì˜ì–´ ë‹¨ì–´, í•œêµ­ì‚¬) â†’ \n"
        "2ï¸âƒ£ ì´í•´ ê³¼ëª© (ì˜ˆ: ìˆ˜í•™, ê³¼í•™ ê°œë…) â†’ \n"
        "3ï¸âƒ£ ì¢…í•© ì •ë¦¬/ë¬¸ì œí’€ì´ (ì˜ˆ: ê¸°ì¶œë¬¸ì œ, ëª¨ì˜ê³ ì‚¬)"
    )

    st.success("âœ¨ ëª©í‘œê°€ ìë™ìœ¼ë¡œ ìº˜ë¦°ë”ì— ë¶„ë°°ë˜ê³ , ìš°ì„ ìˆœìœ„ ì œì•ˆì´ ì™„ë£Œëì–´ìš”!")
